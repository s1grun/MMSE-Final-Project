<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>index</title>
    <script src="../static/js/jquery-1.12.3.min.js"></script>
    <script>
// $(function() {
    // $('#creatseEvent').click(function(){
    //         console.log(1234);
    //         openForm();
    //         return false; });});


function hideForm() {
    $('#form1').css('display','none');
        $('#form2').css('display','none');
        $('#form3').css('display','none');
}

// forgot to inform scso
    function openForm(t) {
        $('#taskView').css('display','none');
        hideForm();
        document.getElementById('form'+t).style.display = 'block'
    }

    function viewEvent(eventId,type) {
        hideForm();
        $.ajax({
                type: "GET",
                contentType: 'application/json',
                url:  `/viewEvent?eventId=${eventId}`,
                dataType: "json",
                error: function(){},
                // data: jsn,
                success:function(response){
                    var view = document.getElementById('eventView');
                    view.style.display = 'block';
                    // console.log(JSON.parse(JSON.stringify(response) ));
                    view.innerText ='';
                    response.event.map(function (item, index) {
                        console.log(item)
                        var li = document.createElement('div');
                        li.innerText = item;
                        view.append(li);
                    })

                    if(type=='unread'){
                        if('{{user}}' != 'FM'){
                            view.innerHTML += `<button onclick="updateEvent('reject',${eventId})" id="reject-btn">reject</button><br/>`;
                        }

                        if('{{user}}' == 'FM'){
                            view.innerHTML += `<textarea id="comment"></textarea><br/>`;
                        }

                        if('{{user}}' == 'AM'){
                            view.innerHTML += `<button onclick="updateEvent('approve',${eventId})" id="approve-btn">approve</button><br/>`;
                        }


                        if('{{user}}' != 'AM'){

                             view.innerHTML += `<select name="submitTo" id="submitTo">
                                            <!--<option value="SCSO">SCSO</option>-->
                                            <option value="FM">FM</option>
                                            <option value="AM">AM</option>
                                        </select><br/>`
                            view.innerHTML += `<button onclick="submitEvent(${eventId})" id="submit-btn">submit</button>`
                        }


                    }


                }

    });
    }
    function hide(){
        $('#reject-btn').css('display','none');
        $('#submitTo').css('display','none');
        $('#submit-btn').css('display','none');
        $('#approve-btn').css('display','none');
        $('#comment').css('display','none');
    }

    function updateEvent(t,id) {
         $.ajax({
                type: "GET",
                contentType: 'application/json',
                url:  `/updateEvent?eventId=${id}&user={{user}}&type=${t}`,
                dataType: "json",
                error: function(){},
                // data: jsn,
                success:function(response){
                    var view = document.getElementById('eventView');
                    view.innerHTML += response.res;
                    hide()

                }
         })
    }

    function submitEvent(id) {
        var to = document.getElementById('submitTo').value;
        var cmt ='';
        if ('{{user}}'=='FM'){
             cmt = document.getElementById('comment').value;
        }

        $.ajax({
                type: "GET",
                contentType: 'application/json',
                url:  `/submitEvent?to=${to}&eventId=${id}&comment=${cmt}&from={{user}}`,
                dataType: "json",
                error: function(){},
                // data: jsn,
                success:function(response){
                    var view = document.getElementById('eventView');
                    view.innerHTML += response.res;
                    hide()

                }
         })

    }






    function viewTask(taskId, type) {
        hideForm();
        $('#taskView').css('display','block');
        $.ajax({
            type: "GET",
            contentType: 'application/json',
            url: `/viewTask?taskId=${taskId}`,
            dataType: "json",
            error: function () {
            },
            // data: jsn,
            success: function (response) {
                var view = document.getElementById('taskView');
                view.style.display = 'block';
                // console.log(JSON.parse(JSON.stringify(response) ));
                view.innerText = '';
                response.event.map(function (item, index) {
                    console.log(item);
                    var li = document.createElement('div');
                    li.innerText = item;
                    view.append(li);
                });
                if(type=='unread'){


                        if('{{user}}' == 'subTeam'){
                            view.innerHTML += `<textarea id="comment"></textarea><br/>`;
                        }

                             view.innerHTML += `<select name="submitTo" id="submitTo">

                                            <option value="SMPM">SMPM</option>
                                        </select><br/>`
                            view.innerHTML += `<button onclick="submitTask(${taskId})" id="submit-btn">submit</button>`



                    }


            }
        })

    }

    function submitTask(id) {
         var to = document.getElementById('submitTo').value;
        var cmt = document.getElementById('comment').value;
        $.ajax({
                type: "GET",
                contentType: 'application/json',
                url:  `/submitTask?to=${to}&taskId=${id}&comment=${cmt}&from={{user}}`,
                dataType: "json",
                error: function(){},
                // data: jsn,
                success:function(response){
                    var view = document.getElementById('taskView');
                    view.innerHTML += response.res;
                    hide()

                }
         })
    }


    // window.onload = function(){
    //     console.log(1234);
    //     var $btn = $('button');
    //     console.log($btn);
    // }
    // function createHiringRequest(){
    //
    // }
    function viewHiringRequest(taskId, type) {
        hideForm();
        $('#taskView').css('display','block');
        $.ajax({
            type: "GET",
            contentType: 'application/json',
            url: `/viewTask?taskId=${taskId}`,
            dataType: "json",
            error: function () {
            },
            // data: jsn,
            success: function (response) {
                var view = document.getElementById('taskView');
                view.style.display = 'block';
                // console.log(JSON.parse(JSON.stringify(response) ));
                view.innerText = '';
                response.event.map(function (item, index) {
                    console.log(item);
                    var li = document.createElement('div');
                    li.innerText = item;
                    view.append(li);
                });
                if(type=='unread'){


                        if('{{user}}' == 'subTeam'){
                            view.innerHTML += `<textarea id="comment"></textarea><br/>`;
                        }

                             view.innerHTML += `<select name="submitTo" id="submitTo">

                                            <option value="SMPM">SMPM</option>
                                        </select><br/>`
                            view.innerHTML += `<button onclick="submitTask(${taskId})" id="submit-btn">submit</button>`



                    }


            }
        })

    }




</script>
</head>
<body>
    <div id="user">Hi, {{ user }}</div>

    {% for btn in views%}

    {% if btn == 'createEvent'%}
        <button id='createEvent' onclick="openForm(1)" >{{btn}}</button>
    {% endif%}

    {% if btn == 'createTask'%}
        <button id='createTask' onclick="openForm(2)" >{{btn}}</button>
    {% endif%}

    {% if btn == 'createHiringRequest'%}
        <button id='createHiringRequest' onclick="openForm(3)" >{{btn}}</button>
    {% endif%}

    <!--{% if btn == 'viewHiringRequest'%}-->
        <!--<button id='viewHiringRequest' onclick="openForm(3)" >{{btn}}</button>-->
    <!--{% endif%}-->


    {%endfor%}


    {% if user == 'SCSO' or user == 'FM' or user =='AM'%}
        <div>
            event view:
            <ul>
        {% for e in eventList %}
            {% if e != ''%}
            <a href="javascript:viewEvent({{e.split(' ')[0]}},'{{e.split(' ')[1]}}')"><li>{{e}}</li></a>
            {% endif%}
        {% endfor%}
            </ul>

             <div id="eventView">


            </div>
        </div>

    {% endif%}

    {% if user == 'SMPM' or user == 'subTeam'%}
        <div>
            task view:
            <ul>
        {% for tsk in taskList %}
            {% if tsk != ''%}
            <a href="javascript:viewTask({{tsk.split(' ')[0]}},'{{tsk.split(' ')[1]}}')"><li>{{tsk}}</li></a>
            {% endif%}
        {% endfor%}
            </ul>

             <div id="taskView">


            </div>
        </div>

    {% endif%}








    <div id="form1" style="display: none">
        <form id="eventForm" action="/createEvent">
            clientName<br/>
            <select name="clientName">
                <option value="A">A</option>
                <option value="B">B</option>
                <option value="C">C</option>
            </select><br/>
            eventName<br/>
            <input type="text" name="eventName"><br/>
            startDate<br/>
            <input type="date" name="startDate"><br/>
            endDate<br/>
            <input type="date" name="endDate"><br/>
            budget<br/>
            <input type="number" name="budget"><br/>
            submitTo<br/>
            <select name="submitTo">
                <option value="SCSO">SCSO</option>
                <option value="FM">FM</option>
                <option value="AM">AM</option>
            </select><br/>
            <!--eventId<br/>-->
            <!--<input type="text" value="time">-->
            <input type="submit" value="Submit">
        </form>

    </div>



    <div id="form2" style="display: none">
        <form id="taskForm" action="/createTask">
            clientName<br/>
            <select name="clientName">
                <option value="A">A</option>
                <option value="B">B</option>
                <option value="C">C</option>
            </select><br/>
            eventName<br/>
            <input type="text" name="eventName"><br/>
            taskName<br/>
            <input type="text" name="taskName"><br/>
            activity<br/>
            <input type="text" name="activity"><br/>
            budget<br/>
            <input type="number" name="budget"><br/>
            submitTo<br/>
            <select name="submitTo">
                <option value="subTeam">subTeam</option>
            </select><br/>
            <!--eventId<br/>-->
            <!--<input type="text" value="time">-->
            <input type="submit" value="Submit">
        </form>

    </div>





</body>




</html>